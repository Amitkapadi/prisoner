(function(){!function(a,b){"function"==typeof define&&define.amd?define([],b):"object"==typeof module&&module.exports?module.exports=b():a.prisoner=b()}(this,function(){var a,b,c,d;return b=function(){function a(a,b){if(this.begin=a,this.end=b,this.horizontal=this.begin.y===this.end.y,this.begin.x>this.end.x||this.begin.y>this.end.y||this.begin.x===this.end.x&&this.begin.y===this.end.y)throw new Error("Piece coordinates aren't valid.")}return a}(),a=function(){function a(a){var b,c,d,e,f,g,h,i;for(this.width=a.width,this.height=a.height,d=a.prisoner,this.matrix=[],i=b=0,e=this.width;e>=0?e>b:b>e;i=e>=0?++b:--b){for(g=[],h=c=0,f=this.height;f>=0?f>c:c>f;h=f>=0?++c:--c)g.push(0);this.matrix.push(g)}this.pieces=[],this.addPiece(d)}return a.prototype.addPiece=function(a){var b,c,d,e,f,g,h;for(this.pieces.push(a),c=this.pieces.length,f=[],g=b=d=a.begin.x,e=a.end.x+1;e>=d?e>b:b>e;g=e>=d?++b:--b)f.push(function(){var b,d,e,f;for(f=[],h=b=d=a.begin.y,e=a.end.y+1;e>=d?e>b:b>e;h=e>=d?++b:--b)f.push(this.matrix[h][g]=c);return f}.call(this));return f},a.prototype.move=function(a,b){var c;if(c=this.pieces[a],c.horizontal){if(b){if(c.end.x+1<this.matrix[0].length&&0===this.matrix[c.begin.y][c.end.x+1])return this.matrix[c.begin.y][c.begin.x]=0,this.matrix[c.begin.y][c.end.x+1]=a+1,c.begin.x+=1,c.end.x+=1,!0}else if(c.begin.x-1>=0&&0===this.matrix[c.begin.y][c.begin.x-1])return this.matrix[c.begin.y][c.end.x]=0,this.matrix[c.begin.y][c.begin.x-1]=a+1,c.begin.x-=1,c.end.x-=1,!0}else if(b){if(c.end.y+1<this.matrix.length&&0===this.matrix[c.end.y+1][c.begin.x])return this.matrix[c.begin.y][c.begin.x]=0,this.matrix[c.end.y+1][c.begin.x]=a+1,c.begin.y+=1,c.end.y+=1,!0}else if(c.begin.y-1>=0&&0===this.matrix[c.begin.y-1][c.begin.x])return this.matrix[c.end.y][c.begin.x]=0,this.matrix[c.begin.y-1][c.begin.x]=a+1,c.begin.y-=1,c.end.y-=1,!0;return!1},a.prototype.canExit=function(){var a,b,c,d,e,f,g,h,i;if(c=this.pieces[0],c.horizontal){for(h=a=d=c.end.x+1,e=this.width;e>=d?e>a:a>e;h=e>=d?++a:--a)if(0!==this.matrix[c.end.y][h])return!1}else for(i=b=f=c.end.y+1,g=this.height;g>=f?g>b:b>g;i=g>=f?++b:--b)if(0!==this.matrix[i][c.end.x])return!1;return!0},a}(),c=function(c){var d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u;for(h=c.length,s=c[0].length,d=[],u=j=0,o=h;o>=0?o>j:j>o;u=o>=0?++j:--j)for(t=k=0,p=s;p>=0?p>k:k>p;t=p>=0?++k:--k)d[c[u][t]]||(d[c[u][t]]=[]),d[c[u][t]].push({x:t,y:u});for(n=[],i=l=1,q=d.length;q>=1?q>l:l>q;i=q>=1?++l:--l)e=d[i][0],f=d[i][d[i].length-1],n.push(new b(e,f));for(g=new a({width:s,height:h,prisoner:n[0]}),i=m=1,r=n.length;r>=1?r>m:m>r;i=r>=1?++m:--m)g.addPiece(n[i]);return g},d=function(a){var b,c,d,e,f,g,h,i,j;for(b=[],i=[a];i.length;){if(c=i.pop(),c.canExit())return c;if(-1===b.indexOf(JSON.stringify(c)))for(f=JSON.stringify(c),b.push(f),d=e=0,j=c.pieces.length;j>=0?j>e:e>j;d=j>=0?++e:--e)h=JSON.parse(f),h.__proto__=c.__proto__,g=JSON.parse(f),g.__proto__=c.__proto__,h.move(d,!0)&&i.push(h),g.move(d,!1)&&i.push(g)}return!1},{Piece:b,Game:a,arrayToGame:c,solve:d}})}).call(this);